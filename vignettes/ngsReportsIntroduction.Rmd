---
title: "An Introduction To ngsReports"
author:
- name: Steve Pederson
  affiliation: Bioinformatics Hub, University of Adelaide
- name: Chris Ward
  affiliation: School of Biological Sciences, University of Adelaide
  email: stephen.pederson@adelaide.edu.au
package: ngsReports
output:
  BiocStyle::html_document2
vignette: >
  %\VignetteIndexEntry{An Introduction To ngsReports}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

The package `ngsReports` is designed to bolt into data processing pipelines and produce combined plots for FastQC reports across an entire set of libraries.
Output as generated by the tool [FastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) will be loaded and replotted using functions from `r CRANpkg("ggplot2")` and `r CRANpkg("plotly")`, as well as custom summary plots.

Tables of read counts can be easily generated, and in addition to the combined plots, a `r CRANpkg("shiny")` app is available for data exploration (Section \@ref(using-the-shiny-app)).

# Basic Usage

## The default report

In it's simplest form, a default report can be generated simply by specifying a directory containing the output from FastQC and calling the function `writeHtmlReport()`.

```{r}
library(ngsReports)
```


```{r, eval = FALSE}
fileDir <- system.file("extdata", package = "ngsReports")
writeHtmlReport(fileDir)
```

This function will transfer the default template to the provided directory and produce a single `.html` file containing interactive summary plots of any FastQC output found in the directory.
FastQC output can be `*fastqc.zip` files or the same files extracted as individual directories.

The default template is provided as `ngsReports_Fastqc.Rmd` in the package directory.
This can be easily modified and supplied as an alternate template to the above function.

```{r, eval = FALSE}
altTemplate <- file.path("path", "to", "template.Rmd")
writeHtmlReport(fileDir, template = altTemplate)
```


## Using the `shiny` app

The `shiny` app can be called by simply calling the function `fastqcShiny()` and loading files manually.
Alternatively, a predefined set of `FastQC` files can be passed as a character vector, `FastqcFileList` or as a `FastqcDataList`.
In the following, the supplied example files are passed to the app as a simple `character` vector.

```{r, eval=FALSE}
files <- list.files(fileDir, pattern = "fastqc.zip$", full.names = TRUE)
fastqcShiny(files)
```

# Advanced Usage

## Classes Defined in the Package

The package `ngsReports` introduces four basic `S4` classes: `FastqcFile`, `FastqcFileList`, `FastqcData` & `FastqcDataList`.
`FastqcFile` and `FastqcData` objects hold the location and information from a single report as generated by the standalone tool `FastQC`^[https://www.bioinformatics.babraham.ac.uk/projects/fastqc/].
These are simply extended into lists for more than one file.

`FastqcFile` and `FastqcFileList` objects simply contain the path to these reports after checking the files contain the files always output by this tool.
`FastqcData` and `FastqcDataList` objects contain the parsed data from the reports.
For most users, the primary class of interest will be the `FastqcDataList`

## Loading FastQC Data Into `R`

To load all `FastQC` data into `R` as a `FastqcDataList`, specify the set of files, then call the function `getFastqcData()`.

```{r}
fileDir <- system.file("extdata", package = "ngsReports")
files <- list.files(fileDir, pattern = "fastqc.zip$", full.names = TRUE)
fdl <- getFastqcData(files)
```

From here, all combined modules (inthe standard order) can be obtained using the functions:

* `Basic_Statistics(fdl)`
* `Per_base_sequence_quality(fdl)`
* `Per_sequence_quality_scores(fdl)`
* `Per_base_sequence_content(fdl)`
* `Per_sequence_GC_content(fdl)`
* `Per_base_N_content(fdl)`
* `Sequence_Length_Distribution(fdl)`
* `Sequence_Duplication_Levels(fdl)`
* `Overrepresented_sequences(fdl)`
* `Adapter_Content(fdl)`
* `Kmer_Content(fdl)`
* `Per_tile_sequence_quality(fdl)`

In addition, the read totals for each file in the library can be obtained using

```{r, results='hide'}
readTotals(fdl)
```

## Generating Plots

Plots created from a single `FastqcData` object will resemble those generated by the `FastQC` tool, whilst those created from a `FastqcDataList` will be combined summaries across a library of files.
All plots are able to be generated as interactive plots using the argument `usePlotly = TRUE`.

Most modules have been enabled for plotting using default `S4` dispatch.

### plotSummary()

A summary of all `PASS/WARN/FAIL` flasg can be simply generated

```{r plotSummary, fig.cap="Default summary of FastQC flags.", fig.wide = TRUE}
plotSummary(fdl)
```

### plotReadTotals()

Read totals from all filesin the library can be simply plotted.
By default, the number of duplicated sequences from the `Sequence Duplication Levels` module are shown, but this can be disabled by setting `duplicated = FALSE`.

```{r}
plotReadTotals(fdl)
```

As these are `ggplot2` objects, the output can be modified easily using conventional `ggplot2` syntax.

```{r}
library(ggplot2)
plotReadTotals(fdl, duplicated = FALSE, barCol = "grey50") + 
  geom_hline(yintercept = 25000, linetype = 2) +
  coord_flip() 
```


# Session info {.unnumbered}

```{r sessionInfo, echo=FALSE}
sessionInfo()
```
